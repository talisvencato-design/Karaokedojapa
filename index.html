<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>KaraokÃª do Japa</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      color: #fff;
      font-family: Arial, sans-serif;
      background: url('./9937771.jpg') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden; /* impede rolagem */
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    header { text-align: center; padding: 20px; }
    header img { max-width: 480px; width: 90%; height: auto; }
    main.wrap {
      flex: 1;
      display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start;
      gap: 30px; padding: 20px;
    }
    .left { width: 280px; text-align: center; flex-shrink: 0; }
    .right {
      flex: 1; background: rgba(0,0,0,0.7); border-radius: 12px;
      padding: 20px; text-align: center; min-height: 380px; max-width: 900px;
      min-width: 300px;
    }
    input#codigo {
      width: 220px; padding: 14px; font-size: 22px;
      border-radius: 8px; border: none; text-align: center;
    }
    .keypad {
      display: grid; grid-template-columns: repeat(3, 90px);
      gap: 12px; margin-top: 18px; justify-content: center;
    }
    .keypad button {
      padding: 16px; font-size: 20px; border-radius: 8px;
      border: none; cursor: pointer; background: #333; color: #fff;
      transition: background 0.1s;
    }
    .keypad button:active { background: #555; }
    .keypad .enter {
      background: #28a745;
      grid-column: 1 / -1; /* ocupa a largura total */
    }
    .keypad .clear { background: #dc3545; }
    .keypad .back { background: #ff8800; }
    .thumbnails {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 20px; margin-top: 20px;
    }
    .thumbnails img {
      width: 240px; border-radius: 10px;
      border: 3px solid #666; cursor: pointer;
      transition: transform .15s;
    }
    .thumbnails img:hover {
      transform: scale(1.08); border-color: #ffcc00;
    }
    #webviewer {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      display: none; justify-content: center; align-items: center;
      z-index: 9999;
      flex-direction: column;
    }
    #closeBtn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: #dc3545;
      color: white;
      border: none;
    }
  </style>
</head>
<body>

  <!-- TODO o conteÃºdo original aqui (mantido exatamente igual) -->

  <script>
    function requestFullscreen(element) {
      if (element.requestFullscreen) {
        element.requestFullscreen().catch(err => console.error("Erro ao tentar Fullscreen:", err));
      } else if (element.mozRequestFullScreen) { /* Firefox */
        element.mozRequestFullScreen();
      } else if (element.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) { /* IE/Edge */
        element.msRequestFullscreen();
      }
    }

    let ytPlayer = null;

    function abrirVideoNoWebViewer(videoId) {
      bgAudio.pause();
      viewer.style.display = "flex";
      scoreDisplay.style.display = "none";
      fireworksContainer.style.display = "none";
      
      if (!document.getElementById('ytapi')) {
        const tag = document.createElement('script');
        tag.id = 'ytapi';
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);
      }

      if (window.YT && YT.Player) {
        criarOuCarregarVideo(videoId);
      } else {
        window.onYouTubeIframeAPIReady = () => criarOuCarregarVideo(videoId);
      }
    }

    function criarOuCarregarVideo(videoId) {
      if (ytPlayer) {
        try { ytPlayer.destroy(); } catch(e){}
        ytPlayer = null;
        document.getElementById('youtubeFrame').innerHTML = ''; 
      }

      ytPlayer = new YT.Player('youtubeFrame', {
        videoId: videoId,
        playerVars: { 
          autoplay: 1, 
          controls: 1, 
          rel: 0, 
          modestbranding: 1 
        },
        host: 'https://www.youtube.com', 
        events: {
          'onReady': (e) => {
            try {
              const iframe = e.target.getIframe();
              requestFullscreen(iframe); // fullscreen real no vÃ­deo
            } catch (err) {
              console.error("Erro fullscreen:", err);
            }
          },
          'onStateChange': e => {
            if (e.data === YT.PlayerState.ENDED) mostrarPontuacao();
          }
        }
      });
    }

    function mostrarPontuacao() {
      try { if (ytPlayer && ytPlayer.stopVideo) ytPlayer.stopVideo(); } catch(e){}
      scoreDisplay.style.display = "flex";
      scoreText.textContent = "0";
      applauseAudio.currentTime = 0;
      applauseAudio.play().catch(()=>{});

      let randomInterval = setInterval(() => { scoreText.textContent = Math.floor(Math.random() * 101); }, 50);

      setTimeout(() => {
        clearInterval(randomInterval);
        const finalScore = Math.floor(Math.random() * (100 - 75 + 1)) + 75;
        scoreText.textContent = finalScore;
        fireworksContainer.style.display = "block";
        setTimeout(() => { fecharWebViewer(); }, 5000);
      }, 2000);
    }

    function fecharWebViewer() {
      if (document.exitFullscreen) document.exitFullscreen().catch(()=>{});
      else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.msExitFullscreen) document.msExitFullscreen();

      viewer.style.display = "none";
      scoreDisplay.style.display = "none";
      fireworksContainer.style.display = "none";
      applauseAudio.pause(); applauseAudio.currentTime = 0;
      if (ytPlayer) { try { ytPlayer.destroy(); } catch(e){} ytPlayer = null; }
      document.getElementById('youtubeFrame').innerHTML = '';
      resultado.innerHTML = "<p>ðŸ”Ž Digite um cÃ³digo para comeÃ§ar.</p>";
      codigo.value = "";
      bgAudio.play().catch(()=>{});
    }

    carregarMusicas();
  </script>
</body>
</html>
